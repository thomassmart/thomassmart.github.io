<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.3">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2018-07-21T20:20:24+10:00</updated><id>http://localhost:4000/</id><title type="html">Tom Blogs</title><subtitle>A space for writings about Storage Spaces Direct (S2D), Infrastructure, Data Protection and other IT Shenanigans</subtitle><author><name>Thomas Smart</name></author><entry><title type="html">Test Post</title><link href="http://localhost:4000/jekyll/update/2018/07/11/Test-Blog-Post.html" rel="alternate" type="text/html" title="Test Post" /><published>2018-07-11T00:00:00+10:00</published><updated>2018-07-11T00:00:00+10:00</updated><id>http://localhost:4000/jekyll/update/2018/07/11/Test-Blog-Post</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2018/07/11/Test-Blog-Post.html">I thought I'd start with a test post. *waves* HIYA!

* Example 1
* Example 2
* Example 3

&gt; Something.

&gt; Something 2



~~~~~~~~~~~

CODEY


~~~~~~~~~~~~~</content><author><name>Thomas Smart</name></author><category term="Test" /><summary type="html">I thought I’d start with a test post. waves HIYA!</summary></entry><entry><title type="html">S4B Room System on Surface Pro 3</title><link href="http://localhost:4000/devices%20and%20endpoints/skype%20for%20business%202015/2017/02/22/s4b-room-system-on-surface-pro-3.html" rel="alternate" type="text/html" title="S4B Room System on Surface Pro 3" /><published>2017-02-22T22:01:00+11:00</published><updated>2017-02-22T22:01:00+11:00</updated><id>http://localhost:4000/devices%20and%20endpoints/skype%20for%20business%202015/2017/02/22/s4b-room-system-on-surface-pro-3</id><content type="html" xml:base="http://localhost:4000/devices%20and%20endpoints/skype%20for%20business%202015/2017/02/22/s4b-room-system-on-surface-pro-3.html">Recently MS have released the Skype for Business Room system app on the windows store. Seeing that it has been made to work on a surface pro in a dock, I dusted off an old SP3 found a dock and though, lets give this a crack. After much dicking around and installing windows 10 I installed the app from the store (&lt;a href=&quot;https://www.microsoft.com/en-us/store/p/skype-room-system/9nblggh5799l&quot;&gt;https://www.microsoft.com/en-us/store/p/skype-room-system/9nblggh5799l&lt;/a&gt;)

The app shows 4 steps to config, I put in all the required details (After setting up a new Room System account in AD/Exch/S4B) and everything was going smoothly until I got to the last page. Please connect to a dock. WHAT?! The tablet is in the dock, whats the problem. The dock was working fine, with all peripherals attached through it.

Lesson here, vendors can mislead through not enough information. After much researching the app will only work with:
&lt;ul&gt;
	&lt;li&gt;A Surface Pro 4 i5 (SP4's with other processors aren't supported)&lt;/li&gt;
	&lt;li&gt;A 'Skype for Business' dock, i.e:
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.crestron.com/products/line/crestron-rl-presentation-collaboration-conference-room-lync&quot;&gt;Crestron RL2&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.logitech.com/en-au/product/smartdock&quot;&gt;Logitech Smart Dock&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.polycom.com/hd-video-conferencing/microsoft-video/msr-series.html&quot;&gt;Polycom MSR&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
Its worth noting that most distributors and vendors provide these as a package

Its such a shame that MS have locked down the apps functionality, if you agree, please vote here: &lt;a href=&quot;https://www.skypefeedback.com/forums/299913-generally-available/suggestions/18416881-open-up-s4b-room-system-app-to-more-devices-and-do&quot;&gt;Skype for Business Feedback&lt;/a&gt;</content><author><name>fatguymemoirs</name></author><summary type="html">Recently MS have released the Skype for Business Room system app on the windows store. Seeing that it has been made to work on a surface pro in a dock, I dusted off an old SP3 found a dock and though, lets give this a crack. After much dicking around and installing windows 10 I installed the app from the store (https://www.microsoft.com/en-us/store/p/skype-room-system/9nblggh5799l)</summary></entry><entry><title type="html">Engaged tone when calling extension</title><link href="http://localhost:4000/authentication/lync-2013/polycom-vvx/2017/02/06/engaged-tone-when-calling-extension.html" rel="alternate" type="text/html" title="Engaged tone when calling extension" /><published>2017-02-06T14:03:00+11:00</published><updated>2017-02-06T14:03:00+11:00</updated><id>http://localhost:4000/authentication/lync-2013/polycom-vvx/2017/02/06/engaged-tone-when-calling-extension</id><content type="html" xml:base="http://localhost:4000/authentication/lync-2013/polycom-vvx/2017/02/06/engaged-tone-when-calling-extension.html">A client was experiencing a weird issue where an extension could call outbound, but didn't receive any incoming calls. Callers would hear the busy tone, and if exchange um hadn't been configured, disconnected.

Comparing the CS-User to a known working extension showed no differences and there were no extension conflicts.

If you are having this issue, I'd recommend the following

1. Open the report server
2. Click the user activity report
3. Search for the user you completed the testing from ![Screenshot]({{ site.url }}/assets/img/engaged-tone/sipdomain.png)
4. Find the call  ![Screenshot]({{ site.url }}/assets/img/engaged-tone/activity.png)
5. Open the details of the call, then open the details for the diagnostics of the call

In my instance, I had the error message

{% highlight vbnet %}
The routing rules did not result in a final response and callee is not enabled for Unified Messaging
{% endhighlight %}
![Screenshot]({{ site.url }}/assets/img/engaged-tone/detail.png)

[Greig from greiginsydney has seen this before and reports that it is caused by bad firmware adding an incorrect call forward rule.](https://greiginsydney.com/polycom-vvx-gives-sip480-cant-be-called/) Following Greig's steps and re-creating the AD account and Lync account resolved the issue.
Also, [Greigs blog](https://greiginsydney.com) is beyond wizardy and you should definately check it out.</content><author><name>Thomas Smart</name></author><summary type="html">A client was experiencing a weird issue where an extension could call outbound, but didn’t receive any incoming calls. Callers would hear the busy tone, and if exchange um hadn’t been configured, disconnected.</summary></entry><entry><title type="html">Polycom VVX Phone Manager Script</title><link href="http://localhost:4000/skype-for-business/2017/02/03/polycom-vvx-phone-manager-script.html" rel="alternate" type="text/html" title="Polycom VVX Phone Manager Script" /><published>2017-02-03T15:06:00+11:00</published><updated>2017-02-03T15:06:00+11:00</updated><id>http://localhost:4000/skype-for-business/2017/02/03/polycom-vvx-phone-manager-script</id><content type="html" xml:base="http://localhost:4000/skype-for-business/2017/02/03/polycom-vvx-phone-manager-script.html">James Cussen has wrote an excellent script for managing Polycom VVX phones.

Its really intuitive and assist with management migrations from phone systems where endpoints and their IP addresses were easy to see (Think asterisk sip show peers). You can easily see all VVX phones that are in the monitoring DB as well as search subnets

![Screenshot]({{ site.url }}/assets/img/vvxmanager/VVX-utility.png)

This tool is absolutely legendary and can be downloaded from technet
[Here](https://gallery.technet.microsoft.com/Skype-for-Business-Lync-04884260&quot;)

James also has a really good write up [here](http://www.myskypelab.com/2015/10/skype-for-business-lync-polycom-vvx.html&quot;) outlining all the features and usage.</content><author><name>Thomas Smart</name></author><category term="Skype-for-Business" /><category term="Lync-2013" /><category term="Polycom-VVX" /><summary type="html">James Cussen has wrote an excellent script for managing Polycom VVX phones.</summary></entry><entry><title type="html">VVX PIN Authentication Error</title><link href="http://localhost:4000/skype-for-business/2017/02/02/pin-authentication-error.html" rel="alternate" type="text/html" title="VVX PIN Authentication Error" /><published>2017-02-02T12:28:00+11:00</published><updated>2017-02-02T12:28:00+11:00</updated><id>http://localhost:4000/skype-for-business/2017/02/02/pin-authentication-error</id><content type="html" xml:base="http://localhost:4000/skype-for-business/2017/02/02/pin-authentication-error.html">I was having issues with a desk phone (Specifically a Polycom VVX310 running 5.4.0.10182) signing in to Lync 2013 with Ext/Pin. When attempting auth the phone would simply return &quot;Lync Sign in Failed&quot;. Pin Auth had been previously working and no changes to DNS or DHCP had been made and all certificates were valid.

I cranked up the logs on the device and still couldn't see any issues. It was grabbing the CA on boot and would contact Lync and get a webticket, however the following in the log raised an eyebrow.

~~~~~~~~~~~
 0202115811|tickt|*|00|m_validUntil [0]
 0202115811|tickt|*|00|m_validityDuration [0]
 0202115811|tickt|*|00|m_bCertExists [0]
 0202115811|tickt|*|00|m_bCertExpired [1]
 0202115811|tickt|*|00|m_eErrorCode [9]
~~~~~~~~~~~~~~

Doubting the HTTPS certificate on the certificate service, I opened and confirmed that it was still valid and trusted.

The next step was to test an alternate phone and an alternate site. Same issue. This points us back to the issue being lync wide.

Luckily there are a few powershell cmdlets that we can use to test the web ticket service.

~~~~~~~~
Test-CSClientAuth
~~~~~~~~
 will allow us to test NTLM authentication against the web ticket service.
 &lt;a href=&quot;https://technet.microsoft.com/en-us/library/gg398712(v=ocs.14).aspx&quot;&gt; TechNet article &lt;/a&gt;

~~~~~~~~
Test-CSPhoneBootsrap
~~~~~~~~

 will allow us to test PIN/EXT auth against the web ticket service.
 &lt;a href=&quot;https://technet.microsoft.com/en-us/library/gg412852.aspx&quot;&gt;TechNet article &lt;/a&gt;

When testing these directly from your lync server you will need to fill out -TargetFqdn and -TargetURI to avoid DHCP lookups/failure. You can alternatively install the module on a PC that has DHCP and test from there.

Typical usage and responses for these cmdlets:

~~~~~~~~~~~

PS&gt; Test-CsClientAuth -UserSipAddress USER@SIPDOMAIN -TargetFqdn LYNCSERVER.DOMAIN
cmdlet Test-CsClientAuthentication at command pipeline position 1
Supply values for the following parameters:
UserCredential


Target Fqdn : LYNCSERVER.DOMAIN
Target Uri : https://LYNCSERVER.DOMAIN:443/CertProv/CertProvisioningService.svc
Result : Success
Latency : 00:00:00.6313045
Error Message :
Diagnosis :


PS&gt; Test-CsPhoneBootstrap -UserSipAddress USER@DOMAIN -PhoneOrExt &quot;EXT&quot; -PIN &quot;PIN&quot; -TargetFqdn LYNCSERVER.DOMAIN -TargetUri &quot;https://LYNCSERVER.DOMAIN:443/CertProv/CertProvisioningService.svc&quot;

Target Fqdn : LYNCSERVER.DOMAIN
Target Uri : https://LYNCSERVER.DOMAIN:443/CertProv/CertProvisioningService.svc
Result : Failure
Latency : 00:00:00.0973450
Error Message : No response received for Web-Ticket service.
 Inner Exception:The HTTP request is unauthorized with client authentication scheme 'Basic'. The authentication header received from the
 server was 'Basic realm =&quot;LYNC&quot;'.
 Inner Exception:The remote server returned an error: (401) Unauthorized.

Diagnosis :
 Inner Diagnosis:Warning : 120 LYNCSERVER.DOMAIN &quot;InvalidPin&quot;
 X-Ms-diagnostics : 28003;source=&quot;LYNCSERVER.DOMAIN&quot;;reason=&quot;The pin is invalid.&quot;;faultcode=&quot;wsse:FailedAuthentication&quot;
 X-MS-Server-Fqdn : LYNCSERVER.DOMAIN
 Strict-Transport-Security : max-age=31536000; includeSubDomains
 X-Content-Type-Options : nosniff
 Content-Length : 4897
 Cache-Control : private
 Content-Type : text/html; charset=utf-8
 Date : Thu, 02 Feb 2017 01:20:52 GMT
 Server : Microsoft-IIS/8.0
 WWW-Authenticate : Basic realm =&quot;LYNC&quot;
 X-Powered-By : ASP.NET

~~~~~~~~~~~

As you can see above, the reason reported back was invalid pin. In my case I wasn't getting a response from the web-ticket at all (Above shown as demonstration)

So the issue was with the web service not responding. I restarted the internal web service within IIS and tested again. This resolved the issue and users were able to use ext/pin sign in again.

![Screenshot]({{ site.url }}/assets/img/pinauth/restart-iis.png)</content><author><name>Thomas Smart</name></author><category term="Skype-for-Business" /><category term="Lync-2013" /><category term="Polycom-VVX" /><summary type="html">I was having issues with a desk phone (Specifically a Polycom VVX310 running 5.4.0.10182) signing in to Lync 2013 with Ext/Pin. When attempting auth the phone would simply return “Lync Sign in Failed”. Pin Auth had been previously working and no changes to DNS or DHCP had been made and all certificates were valid.</summary></entry></feed>